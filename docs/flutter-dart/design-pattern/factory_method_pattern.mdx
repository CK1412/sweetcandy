---
sidebar_position: 2
title: 2. Factory Method Pattern
---

# Factory Method Pattern

> C√≤n ƒë∆∞·ª£c g·ªçi l√† *Virtual Constructor*.

## Factory Method l√† g√¨?

Factory Method l√† m·ªôt m·∫´u thi·∫øt k·∫ø cho ch√∫ng ta ƒë·ªãnh nghƒ©a ƒë∆∞·ª£c nhi·ªÅu ƒë·ªëi t∆∞·ª£ng v√† cho ph√©p c√°c l·ªõp con t·ª± quy·∫øt ƒë·ªãnh 
l√† c√°i n√†o ƒë∆∞·ª£c kh·ªüi t·∫°o, gi√∫p che gi·∫•u logic t·∫°o c·ªßa ƒë·ªëi t∆∞·ª£ng kh·ªèi m√£ m√°y kh√°ch.

## S∆° ƒë·ªì minh ho·∫°

```mermaid
---
title: Relationships diagram
---
classDiagram
  note "L·ªõp Dog v√† Cat ƒë·ªÅu ph·∫£i tri·ªÉn khai giao di·ªán Animal, giao di·ªán n√†y khai b√°o m·ªôt ph∆∞∆°ng th·ª©c c√≥ t√™n l√† `sound`.
        M·ªói l·ªõp th·ª±c hi·ªán ph∆∞∆°ng th·ª©c n√†y m·ªôt c√°ch kh√°c nhau: Ch√≥ (Dog) s·ªßa woof woof, M√®o (Cat) k√™u Meow Meow."
  class Animal
    <<interface>> Animal
    Animal <|-- Cat
    Animal <|-- Dog
    Animal : ...
    Animal: +sound()
  class Dog{
    +...
    +sound()
  }
  class Cat{
    +...
    +sound()
  }
```

## Code tri·ªÉn khai

### Factory Method example

```dart title="Factory Method example"
abstract class Animal {
  factory Animal(AnimalSpecies species) {
    return switch (species) {
      AnimalSpecies.cat => Cat(),
      AnimalSpecies.dog => Dog(),
    };
  }
  void sound() {}
}

class Cat implements Animal {
  @override
  void sound() {
    print('üò∫ Cat call Meow Meow Meow');
  }
}

class Dog implements Animal {
  @override
  void sound() {
    print('üê∂ Dog call Woof woof woof');
  }
}

enum AnimalSpecies {
  dog,
  cat,
}

void main(List<String> args) {
  final Animal cat = Animal(AnimalSpecies.cat);
  final Animal dog = Animal(AnimalSpecies.dog);

  assert(cat is Cat);
  cat.sound(); // üò∫ Cat call Meow Meow Meow

  assert(dog is Dog);
  dog.sound(); // üê∂ Dog call Woof woof woof
}
```

### Factory Method example in Flutter {#factory-method-example-in-flutter}

Trong v√≠ d·ª• n√†y, Factory Method ƒë∆∞·ª£c s·ª≠ d·ª•ng ƒë·ªÉ t·∫°o m·ªôt FilledButton hi·ªÉn th·ªã theo n·ªÅn t·∫£ng. 

:::info

ƒê√¢y ch·ªâ l√† v√≠ d·ª• v·ªÅ c√°ch tri·ªÉn khai Factory Method, trong th·ª±c t·∫ø t√¥i s·∫Ω d√πng c√°ch kh√°c ng·∫Øn h∆°n v·ªõi tr∆∞·ªùng h·ª£p n√†y.

:::

```dart title="Factory Method example in Flutter"
import 'package:flutter/cupertino.dart';
import 'package:flutter/material.dart';

abstract class PlatformFilledButton {
  factory PlatformFilledButton(TargetPlatform platform) {
    return switch (platform) {
      TargetPlatform.android ||
      TargetPlatform.fuchsia ||
      TargetPlatform.linux ||
      TargetPlatform.windows =>
        MaterialFilledButton(),
      TargetPlatform.iOS || TargetPlatform.macOS => CupertinoFilledButton(),
    };
  }

  Widget build(
    BuildContext context, {
    required Widget child,
    required VoidCallback onPressed,
  });
}

class MaterialFilledButton implements PlatformFilledButton {
  @override
  Widget build(
    BuildContext context, {
    required Widget child,
    required VoidCallback onPressed,
  }) {
    return FilledButton(
      onPressed: onPressed,
      child: child,
    );
  }
}

class CupertinoFilledButton implements PlatformFilledButton {
  @override
  Widget build(
    BuildContext context, {
    required Widget child,
    required VoidCallback onPressed,
  }) {
    return CupertinoButton.filled(
      onPressed: onPressed,
      child: child,
    );
  }
}

void main(List<String> args) {
  runApp(const MyAppScreen());
}

class MyAppScreen extends StatelessWidget {
  const MyAppScreen({super.key});

  @override
  Widget build(BuildContext context) {
    return MaterialApp(
      home: Scaffold(
        body: Center(
          child: PlatformFilledButton(Theme.of(context).platform).build(
            context,
            onPressed: () {
              debugPrint('Button pressed!');
            },
            child: const Text('Click me!'),
          ),
        ),
      ),
    );
  }
}
```

## Abstract Factory Method pattern
> M·ªü r·ªông c·ªßa Factory Method

ƒêo·∫°n m√£ d∆∞·ªõi ƒë√¢y s·∫Ω m·ªü r·ªông [v√≠ d·ª• tr∆∞·ªõc ƒë√≥](#factory-method-example-in-flutter) theo Abstract Factory Method.

```dart title="Abstract Factory Method example in Flutter"
import 'package:flutter/cupertino.dart';
import 'package:flutter/material.dart';

abstract class PlatformFilledButton {
  // ...
}

class MaterialFilledButton implements PlatformFilledButton {
  // ...
}

class CupertinoFilledButton implements PlatformFilledButton {
  /// ...
}

abstract class PlatformSwitch {
  factory PlatformSwitch(TargetPlatform platform) {
    return switch (platform) {
      TargetPlatform.android ||
      TargetPlatform.fuchsia ||
      TargetPlatform.linux ||
      TargetPlatform.windows =>
        MaterialSwitch(),
      TargetPlatform.iOS || TargetPlatform.macOS => MyCupertinoSwitch(),
    };
  }

  Widget build(
    BuildContext context, {
    required bool value,
    required ValueChanged<bool> onChanged,
  });
}

class MaterialSwitch implements PlatformSwitch {
  @override
  Widget build(
    BuildContext context, {
    required bool value,
    required ValueChanged<bool> onChanged,
  }) {
    return Switch(
      value: value,
      onChanged: onChanged,
    );
  }
}

class MyCupertinoSwitch implements PlatformSwitch {
  @override
  Widget build(
    BuildContext context, {
    required bool value,
    required ValueChanged<bool> onChanged,
  }) {
    return CupertinoSwitch(
      value: value,
      onChanged: onChanged,
    );
  }
}

/// Implement Abstract Factory Method
///
class PlatformWidget {
  static Widget buildFilledButton(
    BuildContext context, {
    required Widget child,
    required VoidCallback onPressed,
  }) {
    return PlatformFilledButton(Theme.of(context).platform).build(
      context,
      child: child,
      onPressed: onPressed,
    );
  }

  static Widget buildSwitch(
    BuildContext context, {
    required bool value,
    required ValueChanged<bool> onChanged,
  }) {
    return PlatformSwitch(Theme.of(context).platform).build(
      context,
      value: value,
      onChanged: onChanged,
    );
  }
}

void main(List<String> args) {
  runApp(const MyAppScreen());
}

class MyAppScreen extends StatefulWidget {
  const MyAppScreen({super.key});

  @override
  State<MyAppScreen> createState() => _MyAppScreenState();
}

class _MyAppScreenState extends State<MyAppScreen> {
  bool _value = true;

  @override
  Widget build(BuildContext context) {
    return MaterialApp(
      home: Scaffold(
        body: Center(
          child: PlatformWidget.buildSwitch(
            context,
            value: _value,
            onChanged: (value) {
              setState(() {
                _value = value;
              });
            },
          ),
        ),
      ),
    );
  }
}
```

Qua v√≠ d·ª• n√†y, ch√∫ng ta c√≥ th·ªÉ th·∫•y Abstract Factory Method pattern c√≥ m·ªôt s·ªë ∆∞u ƒëi·ªÉm so v·ªõi Factory Method pattern,
cho ph√©p vi·∫øt client code r√µ r√†ng m√† kh√¥ng c·∫ßn bi·∫øt subclass c·ªßa platform n√†o s·∫Ω ƒë∆∞·ª£c t·∫°o.

## T√†i li·ªáu tham kh·∫£o
- https://refactoring.guru/design-patterns/factory-method
- https://dart.academy/creational-design-patterns-for-dart-and-flutter-factory-method/